<div class="container">
  <h3 mat-dialog-title>Añadir Usuario</h3>

  <form class="mat-dialog-content" [formGroup]="form" (ngSubmit)="saveChanges()">

    <!-- Usuario -->
    <div class="form">
      <mat-form-field appearance="fill" color="accent">
        <mat-label>Usuario</mat-label>
        <input matInput formControlName="usuario" required />
        <mat-error *ngIf="form.get('usuario')?.hasError('required')">
          ❌ El campo usuario es obligatorio.
        </mat-error>
        <mat-error *ngIf="form.get('usuario')?.hasError('usernameInvalid')">
          ❌ El nombre de usuario debe tener al menos 4 caracteres.
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Contraseña -->
    <div class="form">
      <mat-form-field appearance="fill" color="accent">
        <mat-label>Contraseña</mat-label>
        <input matInput type="password" formControlName="password" required />
        <mat-error *ngIf="form.get('password')?.hasError('required')">
          ❌ La contraseña es obligatoria.
        </mat-error>
        <mat-error *ngIf="form.get('password')?.hasError('passwordWeak')">
          ❌ Debe tener al menos 6 caracteres, una mayúscula, una minúscula y un carácter especial.
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Nombre público -->
    <div class="form">
      <mat-form-field appearance="fill" color="accent">
        <mat-label>Nombre público</mat-label>
        <input matInput formControlName="nombre_publico" required />
        <mat-error *ngIf="form.get('nombre_publico')?.hasError('required')">
          ❌ El nombre público es obligatorio.
        </mat-error>
        <mat-error *ngIf="form.get('nombre_publico')?.hasError('tooShortPublicName')">
          ❌ El nombre público debe tener al menos 4 caracteres.
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Rol -->
    <div class="form">
      <mat-form-field appearance="fill" color="accent">
        <mat-label>Rol</mat-label>
        <mat-select formControlName="id_rol" required>
          <mat-option *ngFor="let rol of roles" [value]="rol.id_rol">
            {{ rol.nombre_rol }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="form.get('id_rol')?.hasError('required')">
          ❌ El rol es obligatorio.
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Email -->
    <div class="form">
      <mat-form-field appearance="fill" color="accent">
        <mat-label>Email</mat-label>
        <input matInput type="email" formControlName="email" required />
        <mat-error *ngIf="form.get('email')?.hasError('required')">
          ❌ El email es obligatorio.
        </mat-error>
        <mat-error *ngIf="form.get('email')?.hasError('emailInvalid')">
          ❌ El formato del email no es válido.
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Observaciones -->
    <div class="form">
      <mat-form-field appearance="fill" color="accent">
        <mat-label>Observaciones</mat-label>
        <textarea matInput formControlName="observaciones" rows="2"></textarea>
      </mat-form-field>
    </div>

    <!-- Habilitado -->
    <div class="form">
      <mat-checkbox formControlName="habilitado">
        Habilitado
      </mat-checkbox>
    </div>

    <!-- Botones -->
    <div mat-dialog-actions align="end">
      <button mat-button type="button" (click)="cancel()">Cancelar</button>
      <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid">
        Guardar
      </button>
    </div>
  </form>
</div>
